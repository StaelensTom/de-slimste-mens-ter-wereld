{% extends "base.html" %}
{% block content %}
	<link rel="stylesheet" type="text/css" href="/static/css/landing.css">
	<div class="container-fluid text-center">
		<div class="row full align-items-center justify-content-center">
			<div class="col">
				<div id="title">
					<h1 id="title">De Slimste Mens Ter Wereld</h1>
					<img id="halo" src="/static/img/dsmtw_logo.png">
				</div>
				<p class="fs-2" id="attribution">door Anthe Sevenants</p>
				
				{% if not game_initialized %}
				<!-- Configuration Form -->
				<div class="config-form" style="max-width: 600px; margin: 2rem auto;">
					<div class="mb-3">
						<label for="questionSet" class="form-label fs-5">Selecteer vragenset:</label>
						<select class="form-select form-select-lg" id="questionSet">
							<option value="">-- Kies een vragenset --</option>
							{% for dir in question_dirs %}
							<option value="{{ dir }}">{{ dir }}</option>
							{% endfor %}
						</select>
					</div>
					
					<div class="mb-3">
						<label class="form-label fs-5">Spelers:</label>
						<div id="playerInputs">
							<div class="input-group mb-2">
								<input type="text" class="form-control form-control-lg" placeholder="Speler 1" />
								<button class="btn btn-outline-danger" type="button" onclick="removePlayer(this)" title="Verwijder speler">
									<span style="font-size: 1.2em;">✕</span>
								</button>
							</div>
							<div class="input-group mb-2">
								<input type="text" class="form-control form-control-lg" placeholder="Speler 2" />
								<button class="btn btn-outline-danger" type="button" onclick="removePlayer(this)" title="Verwijder speler">
									<span style="font-size: 1.2em;">✕</span>
								</button>
							</div>
							<div class="input-group mb-2">
								<input type="text" class="form-control form-control-lg" placeholder="Speler 3" />
								<button class="btn btn-outline-danger" type="button" onclick="removePlayer(this)" title="Verwijder speler">
									<span style="font-size: 1.2em;">✕</span>
								</button>
							</div>
						</div>
						<button class="btn btn-secondary mt-2" onclick="addPlayer()">+ Voeg speler toe</button>
					</div>
					
					<button class="button" onclick="startGame()" style="margin-top: 1rem;">Start Spel</button>
					<div id="errorMessage" class="text-danger mt-3" style="display: none;"></div>
				</div>
				{% else %}
				<!-- Game Started -->
				<div>
					<a class="button" href="{{ url_for('main.host') }}">Ik ben de presentator</a>
					<a class="button" href="{{ url_for('main.player') }}">Ik ben een speler</a>
				</div>
				<div class="fs-4 pt-4">De volgende vragenset is geladen: {{ global_questions_directory }}</div>
				<div class="mt-4">
					<button class="btn btn-outline-secondary btn-lg" onclick="resetConfiguration()">
						⚙️ Wijzig instellingen (spelers/vragenset)
					</button>
				</div>
				{% endif %}
			</div>
		</div>
	</div>
	
	<script>
		function addPlayer() {
			const playerInputs = document.getElementById('playerInputs');
			const playerCount = playerInputs.children.length + 1;
			
			// Create input group div
			const inputGroup = document.createElement('div');
			inputGroup.className = 'input-group mb-2';
			
			// Create input field
			const input = document.createElement('input');
			input.type = 'text';
			input.className = 'form-control form-control-lg';
			input.placeholder = 'Speler ' + playerCount;
			
			// Create delete button
			const deleteBtn = document.createElement('button');
			deleteBtn.className = 'btn btn-outline-danger';
			deleteBtn.type = 'button';
			deleteBtn.onclick = function() { removePlayer(this); };
			deleteBtn.title = 'Verwijder speler';
			deleteBtn.innerHTML = '<span style="font-size: 1.2em;">✕</span>';
			
			// Assemble
			inputGroup.appendChild(input);
			inputGroup.appendChild(deleteBtn);
			playerInputs.appendChild(inputGroup);
		}
		
		function removePlayer(button) {
			const playerInputs = document.getElementById('playerInputs');
			// Only allow removal if there are more than 2 players
			if (playerInputs.children.length > 2) {
				button.parentElement.remove();
			} else {
				alert('Je hebt minimaal 2 spelers nodig!');
			}
		}
		
		function startGame() {
			const questionSet = document.getElementById('questionSet').value;
			const playerInputs = document.querySelectorAll('#playerInputs input');
			const playerNames = [];
			
			// Collect player names
			playerInputs.forEach(input => {
				if (input.value.trim()) {
					playerNames.push(input.value.trim());
				}
			});
			
			// Validate
			const errorDiv = document.getElementById('errorMessage');
			if (!questionSet) {
				errorDiv.textContent = 'Selecteer een vragenset!';
				errorDiv.style.display = 'block';
				return;
			}
			if (playerNames.length < 2) {
				errorDiv.textContent = 'Voeg minimaal 2 spelers toe!';
				errorDiv.style.display = 'block';
				return;
			}
			
			errorDiv.style.display = 'none';
			
			// Send to server
			fetch('/initialize_game', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					questions_directory: questionSet,
					player_names: playerNames
				})
			})
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					// Reload page to show game buttons
					window.location.reload();
				} else {
					errorDiv.textContent = 'Error: ' + data.error;
					errorDiv.style.display = 'block';
				}
			})
			.catch(error => {
				errorDiv.textContent = 'Error: ' + error;
				errorDiv.style.display = 'block';
			});
		}
		
		function resetConfiguration() {
			if (confirm('Weet je zeker dat je de instellingen wilt wijzigen? De huidige spelconfiguratie gaat verloren.')) {
				fetch('/reset_configuration', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					}
				})
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						// Reload page to show configuration form
						window.location.reload();
					}
				})
				.catch(error => {
					alert('Error: ' + error);
				});
			}
		}
	</script>
{% endblock %}